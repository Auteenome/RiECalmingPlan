<ContentView xmlns="http://xamarin.com/schemas/2014/forms" 
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:d="http://xamarin.com/schemas/2014/forms/design"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:views="clr-namespace:RiECalmingPlan.Views"
             mc:Ignorable="d"
             x:Class="RiECalmingPlan.Views.DisplayQuestionView"
             xmlns:local="clr-namespace:RiECalmingPlan.Views"> <!-- reference local to StepProgressBar.cs -->

    <ContentView.Resources>
        <ResourceDictionary>
            <DataTemplate x:Key="stepperTemplate">
                <StackLayout>
                    <Frame Style="{StaticResource QuestionFrameStyle}">
                        <StackLayout>
                            <Label  BindingContext="{Binding Question}" Text="{Binding QuestionText}" TextColor="Blue" FontAttributes="Italic" HorizontalOptions="Center" MaxLines="5" LineBreakMode="TailTruncation" />

                            <ListView BindingContext="{Binding GeneratedResponses}" ItemsSource="{Binding}" HasUnevenRows="True">
                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <ViewCell>
                                            <StackLayout Orientation="Horizontal">
                                                <Label Text="{Binding StepperText}"/>

                                                <views:StepProgressBar StepColor="Red" Style="{StaticResource StepperStyle} "/>

                                            </StackLayout>
                                        </ViewCell>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                        </StackLayout>
                    </Frame>
                </StackLayout>
            </DataTemplate>

            <DataTemplate x:Key="checkBoxTemplate">
                <StackLayout>
                    <Frame Style="{StaticResource QuestionFrameStyle}">
                        <StackLayout VerticalOptions="Fill">
                            <StackLayout VerticalOptions="Start">
                                <Label BindingContext="{Binding Question}" Text="{Binding QuestionText}" TextColor="Green" FontAttributes="Italic" HorizontalOptions="Center" MaxLines="5" LineBreakMode="TailTruncation" FontSize="Medium" HorizontalTextAlignment="Center"/>
                            </StackLayout>

                            <StackLayout VerticalOptions="CenterAndExpand">
                                <ListView BindingContext="{Binding GeneratedResponses}" ItemsSource="{Binding}" HasUnevenRows="True" >
                                    <ListView.ItemTemplate>
                                        <DataTemplate>
                                            <ViewCell>
                                                <StackLayout Orientation="Horizontal">
                                                    <CheckBox  IsChecked="{Binding CheckBoxValue}" CheckedChanged="OnCheckBoxCheckedChanged" VerticalOptions="Center"/>
                                                    <Label Text="{Binding CheckText}" VerticalOptions="Center"/>
                                                </StackLayout>
                                            </ViewCell>
                                        </DataTemplate>
                                    </ListView.ItemTemplate>
                                </ListView>
                            </StackLayout>

                            <!--
                            This needs a bit of work, since there is a bit of whitespace when there is a small number
                            of elements in this list
                            
                            For now the heightRequest is a simple fix but only works for one element
                            
                            which isn't that bad if we leave it, since there most likely be only one element to work with
                            
                            an example would be if a staff member were to create a new question with multiple written responses
                            -->
                            <StackLayout VerticalOptions="End">
                                <ListView HeightRequest="50" BindingContext="{Binding NonGeneratedResponses}" HasUnevenRows="True" ItemsSource="{Binding}">
                                    <ListView.ItemTemplate>
                                        <DataTemplate>
                                            <ViewCell>
                                                <StackLayout>
                                                    <Editor Text="{Binding TextResponse}" Placeholder="Place your answer here" Completed="Editor_Completed"/>
                                                </StackLayout>
                                            </ViewCell>
                                        </DataTemplate>
                                    </ListView.ItemTemplate>
                                </ListView>
                            </StackLayout>
                        </StackLayout>
                    </Frame>
                </StackLayout>
            </DataTemplate>

            <DataTemplate x:Key="textResponseTemplate">
                <StackLayout>
                    <Frame Style="{StaticResource QuestionFrameStyle}">
                        <StackLayout>
                            <Label  BindingContext="{Binding Question}" Text="{Binding QuestionText}" TextColor="Red" FontAttributes="Italic" HorizontalOptions="Center" MaxLines="5" LineBreakMode="TailTruncation" />

                            <ListView BindingContext="{Binding NonGeneratedResponses}" ItemsSource="{Binding}" HasUnevenRows="True">
                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <ViewCell>
                                            <StackLayout>
                                                <Editor Text="{Binding TextResponse}" Placeholder="Place your answer here" AutoSize="TextChanges" Completed="Editor_Completed"/>
                                            </StackLayout>
                                        </ViewCell>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                        </StackLayout>
                    </Frame>
                </StackLayout>
            </DataTemplate>

            <views:AnswerTemplateSelector x:Key="answerTemplateSelector"
            StepperTemplate="{StaticResource stepperTemplate}"
            CheckBoxTemplate="{StaticResource checkBoxTemplate}"
            TextResponseTemplate="{StaticResource textResponseTemplate}" />

            <Style x:Key="StepperStyle" TargetType="local:StepProgressBar" >
                <Setter Property="Steps" Value="4" />
                <Setter Property="StepSelected" Value="{Binding StepperValue}" />
            </Style>
            
        </ResourceDictionary>
    </ContentView.Resources>

    <ContentView.Content>
      <StackLayout>
            <CarouselView x:Name="Questions" ItemTemplate="{StaticResource answerTemplateSelector}"/>
        </StackLayout>
  </ContentView.Content>
</ContentView>